"use strict";(self["webpackChunkui"]=self["webpackChunkui"]||[]).push([[530],{5434:function(e,s,t){t.r(s),t.d(s,{default:function(){return C}});var r=t(3102),i=function(){var e=this,s=e._self._c;return s(r.Z,[s("Users")],1)},a=[],o=t(4057),n=t(4741),d=t(3816),l=t(5255),c=t(7024),u=t(1819),m=t(3182),h=t(268),p=t(9088),v=t(7894),f=t(2515),x=t(6818),g=t(9007),Z=function(){var e=this,s=e._self._c;return s(u.Z,[e.errorVisible?s(o.Z,{attrs:{type:"error",prominent:"",dismissible:""},on:{input:e.clearError}},[e.error?s("div",[e._v(e._s(e.error))]):s("div",[e._v("An unknown error occurred")])]):e._e(),s(v.Z,[s(c.Z,{attrs:{cols:"12"}},[s(d.Z,{attrs:{dark:""}},[s(l.EB,[e._v(" User Management "),s(f.Z),e.isAdmin?s(n.Z,{attrs:{color:"primary"},on:{click:e.openCreateDialog}},[e._v(" Add New User "),s(p.Z,{attrs:{right:"",dark:""}},[e._v("mdi-account-plus")])],1):e._e()],1),s(m.Z,{staticClass:"elevation-1",attrs:{headers:e.isAdmin?e.adminHeaders:e.userHeaders,items:e.users,search:e.search,dark:""},scopedSlots:e._u([{key:"top",fn:function(){return[s(g.Z,{staticClass:"mx-4",attrs:{label:"Search","prepend-icon":"mdi-magnify"},model:{value:e.search,callback:function(s){e.search=s},expression:"search"}})]},proxy:!0},{key:"item.isAdmin",fn:function({item:t}){return[t.isAdmin?s(p.Z,{attrs:{color:"green"}},[e._v("mdi-check")]):s(p.Z,{attrs:{color:"red"}},[e._v("mdi-close")])]}},{key:"item.actions",fn:function({item:t}){return[e.isAdmin||e.currentUser.sub===t.sub?s(p.Z,{staticClass:"mr-2",attrs:{small:""},on:{click:function(s){return e.editUser(t)}}},[e._v(" mdi-pencil ")]):e._e(),e.isAdmin&&e.currentUser.sub!==t.sub?s(p.Z,{attrs:{small:""},on:{click:function(s){return e.deleteUser(t)}}},[e._v(" mdi-delete ")]):e._e()]}}])})],1)],1)],1),s(h.Z,{attrs:{"max-width":"500px"},model:{value:e.dialog,callback:function(s){e.dialog=s},expression:"dialog"}},[s(d.Z,{attrs:{dark:""}},[s(l.EB,[s("span",{staticClass:"headline"},[e._v(e._s(e.formTitle))])]),s(l.ZB,[s(u.Z,[e.errorVisible?s(o.Z,{attrs:{type:"error",dense:"",text:""}},[e._v(" "+e._s(e.error)+" ")]):e._e(),s(v.Z,[s(c.Z,{attrs:{cols:"12"}},[s(g.Z,{attrs:{label:"Name",rules:[e=>!!e||"Name is required"],required:""},model:{value:e.editedItem.name,callback:function(s){e.$set(e.editedItem,"name",s)},expression:"editedItem.name"}})],1),s(c.Z,{attrs:{cols:"12"}},[s(g.Z,{attrs:{label:"Email",type:"email"},model:{value:e.editedItem.email,callback:function(s){e.$set(e.editedItem,"email",s)},expression:"editedItem.email"}})],1),s(c.Z,{attrs:{cols:"12"}},[s(g.Z,{attrs:{label:"Password",type:"password",hint:e.passwordHint,"persistent-hint":""},model:{value:e.editedItem.password,callback:function(s){e.$set(e.editedItem,"password",s)},expression:"editedItem.password"}})],1),e.isAdmin?s(c.Z,{attrs:{cols:"12"}},[s(x.Z,{attrs:{label:"Administrator",color:"primary"},model:{value:e.editedItem.isAdmin,callback:function(s){e.$set(e.editedItem,"isAdmin",s)},expression:"editedItem.isAdmin"}})],1):e._e()],1)],1)],1),s(l.h7,[s(f.Z),s(n.Z,{attrs:{color:"error",text:""},on:{click:e.closeDialog}},[e._v(" Cancel ")]),s(n.Z,{attrs:{color:"success",text:""},on:{click:e.saveUser}},[e._v(" Save ")])],1)],1)],1),s(h.Z,{attrs:{"max-width":"500px"},model:{value:e.deleteDialog,callback:function(s){e.deleteDialog=s},expression:"deleteDialog"}},[s(d.Z,{attrs:{dark:""}},[s(l.EB,{staticClass:"headline"},[e._v(" Delete User ")]),s(l.ZB,[e._v(" Are you sure you want to delete this user? This action cannot be undone. ")]),s(l.h7,[s(f.Z),s(n.Z,{attrs:{color:"primary",text:""},on:{click:e.closeDeleteDialog}},[e._v(" Cancel ")]),s(n.Z,{attrs:{color:"error",text:""},on:{click:e.confirmDelete}},[e._v(" Delete ")])],1)],1)],1)],1)},b=[],U=t(629),I={name:"Users",data:()=>({search:"",dialog:!1,deleteDialog:!1,adminHeaders:[{text:"Name",value:"name"},{text:"Email",value:"email"},{text:"Admin",value:"isAdmin"},{text:"Actions",value:"actions",sortable:!1}],userHeaders:[{text:"Name",value:"name"},{text:"Email",value:"email"},{text:"Actions",value:"actions",sortable:!1}],editedIndex:-1,editedItem:{sub:"",name:"",email:"",password:"",isAdmin:!1},defaultItem:{sub:"",name:"",email:"",password:"",isAdmin:!1}}),computed:{...(0,U.Se)({users:"users/users",currentUser:"users/currentUser",error:"users/error",errorVisible:"users/errorVisible"}),formTitle(){return-1===this.editedIndex?"New User":"Edit User"},isAdmin(){return this.currentUser&&this.currentUser.isAdmin},passwordHint(){return-1===this.editedIndex?"Enter a new password":"Leave blank to keep current password"}},mounted(){this.fetchUsers(),this.currentUser||this.getCurrentUser()},methods:{...(0,U.nv)("users",{fetchUsers:"fetchUsers",createUser:"createUser",updateUser:"updateUser",removeUser:"deleteUser",setError:"error",doClearError:"clearError"}),getCurrentUser(){this.$store.dispatch("users/fetchCurrentUser")},clearError(){console.log("Clearing error"),this.doClearError()},openCreateDialog(){this.isAdmin&&(this.editedIndex=-1,this.editedItem=Object.assign({},this.defaultItem),this.dialog=!0)},editUser(e){(this.isAdmin||this.currentUser.sub===e.sub)&&(this.editedIndex=this.users.indexOf(e),this.editedItem={...e,password:""},this.dialog=!0)},deleteUser(e){this.isAdmin&&this.currentUser.sub!==e.sub&&(this.editedIndex=this.users.indexOf(e),this.editedItem=Object.assign({},e),this.deleteDialog=!0)},closeDialog(){this.dialog=!1,this.$nextTick((()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))},closeDeleteDialog(){this.deleteDialog=!1,this.$nextTick((()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))},async saveUser(){if(this.clearError(),this.editedItem.name)try{this.isAdmin||(this.editedItem.isAdmin=!1);const e={...this.editedItem};this.editedIndex>-1&&!e.password&&delete e.password,this.editedIndex>-1?await this.updateUser(e):await this.createUser(e),this.closeDialog()}catch(e){if(console.error("Error saving user:",e),console.log("Error object:",{message:e.message,response:e.response,responseData:e.response?.data,errorMessage:e.response?.data?.error}),e.response&&400===e.response.status){const s=e.response.data.error||"The server rejected your request";this.setError(s)}else this.setError("Failed to save user: "+(e.message||"Unknown error"))}else this.setError("Name is required")},async confirmDelete(){try{if(!this.isAdmin)return;await this.removeUser(this.editedItem.sub),this.closeDeleteDialog()}catch(e){console.error("Error deleting user:",e),e.response&&e.response.data&&e.response.data.error?this.setError(e.response.data.error):this.setError("Failed to delete user")}}}},k=I,_=t(1001),A=(0,_.Z)(k,Z,b,!1,null,null,null),w=A.exports,E={name:"users",components:{Users:w}},D=E,y=(0,_.Z)(D,i,a,!1,null,null,null),C=y.exports}}]);
//# sourceMappingURL=Users.101be6ff.js.map